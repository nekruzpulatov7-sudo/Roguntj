<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rogun.tj ‚Äî –ú–∞–≥–∞–∑–∏–Ω –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* –û–°–ù–û–í–ù–û–ô –ö–†–ê–°–ò–í–´–ô –§–û–ù */
        body { 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            background-attachment: fixed;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            min-height: 100vh;
            color: #333;
            transition: background 0.5s ease;
        }

        /* –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê */
        body.dark-mode { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
            color: white; 
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 15px; }

        /* –≠–§–§–ï–ö–¢ –°–¢–ï–ö–õ–ê –î–õ–Ø –®–ê–ü–ö–ò */
        header { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            border-bottom: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }

        .dark-mode header { 
            background: rgba(26, 26, 46, 0.8); 
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header-content { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; }

        /* –ë–ê–ù–ù–ï–† –° –†–û–ì–£–ù–°–ö–û–ô –ì–≠–° */
        .hero-banner {
            width: 100%;
            height: 400px;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                        url('https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Rogun_Dam_construction_2018.jpg/1200px-Rogun_Dam_construction_2018.jpg');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }

        .hero-banner h2 { font-size: 38px; font-weight: 800; margin-bottom: 15px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }

        /* –°–¢–ï–ö–õ–Ø–ù–ù–´–ô –ü–û–ò–°–ö –í–ù–£–¢–†–ò –ë–ê–ù–ù–ï–†–ê */
        .search-glass-box {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 90%;
            max-width: 850px;
        }

        .search-box { display: flex; gap: 10px; flex-wrap: wrap; }
        
        input, select { 
            padding: 12px 15px; 
            border-radius: 12px; 
            border: 1px solid rgba(0,0,0,0.1); 
            outline: none;
            font-size: 15px;
            transition: 0.3s;
        }
        .dark-mode input, .dark-mode select { background: #1f1f3a; color: white; border-color: #333; }
        input:focus, select:focus { border-color: #007bff; box-shadow: 0 0 0 3px rgba(0,123,255,0.1); }

        /* –ö–ê–¢–ï–ì–û–†–ò–ò */
        .cat-nav { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0 20px 0; scrollbar-width: none; }
        .cat-nav::-webkit-scrollbar { display: none; }
        .cat-btn { 
            padding: 10px 18px; 
            border-radius: 25px; 
            border: none; 
            cursor: pointer; 
            background: white; 
            white-space: nowrap; 
            font-size: 14px; 
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: 0.3s;
        }
        .dark-mode .cat-btn { background: #16213e; color: #ddd; }
        .cat-btn.active { background: #007bff; color: white; transform: scale(1.05); }

        /* –°–ï–¢–ö–ê –û–ë–™–Ø–í–õ–ï–ù–ò–ô */
        .ads-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding-bottom: 40px; }

        /* –ö–ê–†–¢–û–ß–ö–ê */
        .product-card { 
            background: white; 
            border-radius: 18px; 
            overflow: hidden; 
            transition: 0.3s ease; 
            cursor: pointer; 
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .dark-mode .product-card { background: #1f1f3a; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.12); }
        .product-card img { width: 100%; height: 180px; object-fit: cover; }
        .product-card .info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-card .price { font-size: 20px; font-weight: 800; color: #28a745; margin-bottom: 8px; }
        .product-card .title { 
            font-size: 15px; font-weight: 600; margin-bottom: 10px; line-height: 1.4; 
            height: 42px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; 
        }
        
        .card-footer { margin-top: auto; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 10px; }
        .category-tag { font-size: 12px; color: #888; }
        .region-tag { font-size: 12px; font-weight: 600; color: #007bff; }

        .btn-add-main { 
            background: #28a745; color: white; padding: 12px 20px; border-radius: 12px; 
            text-decoration: none; font-weight: bold; font-size: 14px; transition: 0.3s; 
            box-shadow: 0 4px 12px rgba(40,167,69,0.3); display: flex; align-items: center; justify-content: center;
        }
        .btn-add-main:hover { background: #218838; transform: scale(1.02); }

        @media (max-width: 768px) {
            .hero-banner { height: 350px; }
            .hero-banner h2 { font-size: 24px; }
            .search-box { flex-direction: column; }
            .search-box > * { width: 100%; }
        }
    </style>
</head>
<body>

<header>
    <div class="container header-content">
        <h1 onclick="location.href='index.html'" style="cursor:pointer; margin:0; font-size: 24px; letter-spacing: -1px; color:#007bff;">Rogun<span style="color:#28a745">.tj</span></h1>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div id="user-menu"></div> 
            <button id="theme-toggle" style="cursor:pointer; border:none; background:none; font-size:22px;">üåô</button>
        </div>
    </div>
</header>

<section class="hero-banner">
    <div class="search-glass-box">
        <h2>–ù–∞–π–¥–∏ –ª—É—á—à–µ–µ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ üèîÔ∏è</h2>
        <div class="search-box">
            <input type="text" id="search-input" placeholder="–ß—Ç–æ –∏—â–µ–º?" style="flex: 2; min-width: 200px;">
            
            <select id="region-filter">
                <option value="">–í–µ—Å—å –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω</option>
                <optgroup label="–û—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞">
                    <option value="–†–æ–≥—É–Ω">–†–æ–≥—É–Ω</option>
                    <option value="–î—É—à–∞–Ω–±–µ">–î—É—à–∞–Ω–±–µ</option>
                    <option value="–•—É–¥–∂–∞–Ω–¥">–•—É–¥–∂–∞–Ω–¥</option>
                    <option value="–ë–æ—Ö—Ç–∞—Ä">–ë–æ—Ö—Ç–∞—Ä</option>
                    <option value="–ö—É–ª—è–±">–ö—É–ª—è–±</option>
                    <option value="–í–∞—Ö–¥–∞—Ç">–í–∞—Ö–¥–∞—Ç</option>
                    <option value="–ò—Å—Ç–∞—Ä–∞–≤—à–∞–Ω">–ò—Å—Ç–∞—Ä–∞–≤—à–∞–Ω</option>
                    <option value="–ì–∏—Å—Å–∞—Ä">–ì–∏—Å—Å–∞—Ä</option>
                    <option value="–¢—É—Ä—Å—É–Ω–∑–∞–¥–µ">–¢—É—Ä—Å—É–Ω–∑–∞–¥–µ</option>
                    <option value="–ö–∞–Ω–∏–±–∞–¥–∞–º">–ö–∞–Ω–∏–±–∞–¥–∞–º</option>
                    <option value="–ò—Å—Ñ–∞—Ä–∞">–ò—Å—Ñ–∞—Ä–∞</option>
                    <option value="–ü–µ–Ω–¥–∂–∏–∫–µ–Ω—Ç">–ü–µ–Ω–¥–∂–∏–∫–µ–Ω—Ç</option>
                    <option value="–ù–æ—Ä–∞–∫">–ù–æ—Ä–∞–∫</option>
                    <option value="–•–æ—Ä—É–≥">–•–æ—Ä—É–≥</option>
                </optgroup>
                <optgroup label="–†–∞–π–æ–Ω—ã –∏ –ø–æ—Å–µ–ª–∫–∏">
                    <option value="–ù—É—Ä–æ–±–æ–¥">–ù—É—Ä–æ–±–æ–¥</option>
                    <option value="–§–∞–π–∑–æ–±–æ–¥">–§–∞–π–∑–æ–±–æ–¥</option>
                    <option value="–†–∞—à—Ç">–†–∞—à—Ç (–ì–∞—Ä–º)</option>
                    <option value="–í–∞—Ä–∑–æ–±">–í–∞—Ä–∑–æ–±</option>
                    <option value="–ê–π–Ω–∏">–ê–π–Ω–∏</option>
                    <option value="–î–∞–Ω–≥–∞—Ä–∞">–î–∞–Ω–≥–∞—Ä–∞</option>
                    <option value="–Ø–≤–∞–Ω">–Ø–≤–∞–Ω</option>
                    <option value="–†—É–¥–∞–∫–∏">–†—É–¥–∞–∫–∏</option>
                    <option value="–®–∞—Ö—Ä–∏–Ω–∞–≤">–®–∞—Ö—Ä–∏–Ω–∞–≤</option>
                    <option value="–õ–∞—Ö—à">–õ–∞—Ö—à</option>
                    <option value="–°–∞–Ω–≥–≤–æ—Ä">–°–∞–Ω–≥–≤–æ—Ä</option>
                    <option value="–¢–∞–¥–∂–∏–∫–∞–±–∞–¥">–¢–∞–¥–∂–∏–∫–∞–±–∞–¥</option>
                    <option value="–í–æ—Å–µ—ä">–í–æ—Å–µ—ä</option>
                    <option value="–§–∞—Ä—Ö–æ—Ä">–§–∞—Ä—Ö–æ—Ä</option>
                    <option value="–ú—É—Ä–≥–∞–±">–ú—É—Ä–≥–∞–±</option>
                </optgroup>
            </select>
            
            <a href="add.html" class="btn-add-main">+ –ü–æ–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
        </div>
    </div>
</section>

<div class="container">
    <nav class="cat-nav" id="category-filter-container">
        <button class="cat-btn active" data-cat="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
        <button class="cat-btn" data-cat="–ü—Ä–æ–¥—É–∫—Ç—ã">üçé –ü—Ä–æ–¥—É–∫—Ç—ã</button>
        <button class="cat-btn" data-cat="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">üì± –¢–µ—Ö–Ω–∏–∫–∞</button>
        <button class="cat-btn" data-cat="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –ê–≤—Ç–æ</button>
        <button class="cat-btn" data-cat="–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å">üè† –ñ–∏–ª—å–µ</button>
        <button class="cat-btn" data-cat="–û–¥–µ–∂–¥–∞">üëï –û–¥–µ–∂–¥–∞</button>
        <button class="cat-btn" data-cat="–î–ª—è –¥–æ–º–∞">üõãÔ∏è –î–ª—è –¥–æ–º–∞</button>
        <button class="cat-btn" data-cat="–£—Å–ª—É–≥–∏">üõ†Ô∏è –£—Å–ª—É–≥–∏</button>
        <button class="cat-btn" data-cat="–†–∞–±–æ—Ç–∞">üíº –†–∞–±–æ—Ç–∞</button>
    </nav>

    <main id="ads-container" class="ads-grid"></main>
</div>

<script type="module">
    import { getAds, getCurrentUser } from './js/storage.js';

    const adsContainer = document.getElementById('ads-container');
    const searchInput = document.getElementById('search-input');
    const regionFilter = document.getElementById('region-filter');
    const userMenu = document.getElementById('user-menu');
    const themeBtn = document.getElementById('theme-toggle');
    const catButtons = document.querySelectorAll('.cat-btn');

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ –∏–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è
    function renderUserMenu() {
        const user = getCurrentUser();
        if (user) {
            userMenu.innerHTML = `<a href="profile.html" style="text-decoration:none; color:#007bff; font-weight:600;">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>`;
        } else {
            userMenu.innerHTML = `<a href="login.html" style="text-decoration:none; color:#007bff; font-weight:600;">–í–æ–π—Ç–∏</a>`;
        }
    }

    // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
    function updateAds() {
        const allAds = getAds() || [];
        const searchText = searchInput.value.toLowerCase();
        const selectedRegion = regionFilter.value;
        const activeBtn = document.querySelector('.cat-btn.active');
        const selectedCategory = activeBtn ? activeBtn.dataset.cat : "";

        const filtered = allAds.filter(ad => {
            const matchesSearch = ad.title.toLowerCase().includes(searchText);
            const matchesRegion = !selectedRegion || ad.region === selectedRegion;
            const matchesCategory = !selectedCategory || ad.category === selectedCategory;
            return matchesSearch && matchesRegion && matchesCategory;
        });

        adsContainer.innerHTML = '';
        
        if (filtered.length === 0) {
            adsContainer.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 80px; color: #888;">
                    <div style="font-size: 50px;">üîç</div>
                    <p style="font-size: 18px; margin-top: 10px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É</p>
                </div>`;
            return;
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
        filtered.sort((a, b) => b.id - a.id).forEach(ad => {
            const imageSrc = ad.images && ad.images.length > 0 ? ad.images[0] : 'https://via.placeholder.com/300x200?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${imageSrc}" alt="${ad.title}" loading="lazy">
                <div class="info">
                    <div class="price">${Number(ad.price).toLocaleString()} TJS</div>
                    <div class="title">${ad.title}</div>
                    <div class="card-footer">
                        <span class="category-tag">${ad.category}</span>
                        <span class="region-tag">üìç ${ad.region || '–†–æ–≥—É–Ω'}</span>
                    </div>
                </div>
            `;
            // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π (—É–±–µ–¥–∏—Å—å, —á—Ç–æ detail.html —Å–æ–∑–¥–∞–Ω)
            card.onclick = () => window.location.href = `detail.html?id=${ad.id}`;
            adsContainer.appendChild(card);
        });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    catButtons.forEach(btn => {
        btn.onclick = () => {
            catButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            updateAds();
        };
    });

    // –ñ–∏–≤–æ–π –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
    searchInput.oninput = updateAds;
    regionFilter.onchange = updateAds;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
    themeBtn.onclick = () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        themeBtn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
    if(localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        themeBtn.textContent = "‚òÄÔ∏è";
    }

    // –ó–∞–ø—É—Å–∫
    renderUserMenu();
    updateAds();
</script>
</body>
</html>