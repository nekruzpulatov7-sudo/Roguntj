<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rogun.tj ‚Äî –ú–∞–≥–∞–∑–∏–Ω –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        body { 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            background-attachment: fixed;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            min-height: 100vh;
            color: #333;
            transition: background 0.5s ease;
            padding-bottom: 80px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é */
        }

        body.dark-mode { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
            color: white; 
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 15px; }

        header { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            border-bottom: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }

        .dark-mode header { 
            background: rgba(26, 26, 46, 0.8); 
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header-content { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; }

        .hero-banner {
            width: 100%;
            height: 400px;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                        url('https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Rogun_Dam_construction_2018.jpg/1200px-Rogun_Dam_construction_2018.jpg');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }

        .hero-banner h2 { font-size: 38px; font-weight: 800; margin-bottom: 15px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }

        .search-glass-box {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 90%;
            max-width: 850px;
        }

        .search-box { display: flex; gap: 10px; flex-wrap: wrap; }
        
        input, select { 
            padding: 12px 15px; 
            border-radius: 12px; 
            border: 1px solid rgba(0,0,0,0.1); 
            outline: none;
            font-size: 15px;
            transition: 0.3s;
        }
        .dark-mode input, .dark-mode select { background: #1f1f3a; color: white; border-color: #333; }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .category-item {
            background: white;
            padding: 20px 10px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .dark-mode .category-item { background: #1f1f3a; border-color: rgba(255,255,255,0.05); }

        .category-item:hover, .category-item.active {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,123,255,0.1);
            border-color: #007bff;
        }
        
        .category-item.active { background: #e7f3ff; border-width: 2px; }
        .dark-mode .category-item.active { background: #25254d; }

        .ads-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding-bottom: 40px; }

        .product-card { 
            background: white; 
            border-radius: 18px; 
            overflow: hidden; 
            transition: 0.3s ease; 
            cursor: pointer; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .dark-mode .product-card { background: #1f1f3a; }
        .product-card img { width: 100%; height: 180px; object-fit: cover; }
        .product-card .info { padding: 15px; }
        .product-card .price { font-size: 18px; font-weight: 800; color: #28a745; }

        /* –ú–û–ë–ò–õ–¨–ù–û–ï –ú–ï–ù–Æ */
        .mobile-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: 70px;
            background: white; display: flex; justify-content: space-around;
            align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000;
        }
        .dark-mode .mobile-nav { background: #1a1a2e; border-top: 1px solid #333; }
        .nav-item { text-decoration: none; color: #888; display: flex; flex-direction: column; align-items: center; font-size: 11px; font-weight: 600; }
        .nav-item span:first-child { font-size: 22px; margin-bottom: 2px; }
        .nav-item.active { color: #007bff; }
        .add-icon-circle { 
            width: 55px; height: 55px; background: #28a745; color: white; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 24px; margin-top: -35px; border: 5px solid #f4f7f6;
            box-shadow: 0 4px 10px rgba(40,167,69,0.3);
        }
        .dark-mode .add-icon-circle { border-color: #121225; }

        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
        .modal-tg {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white; margin: 15% auto; padding: 30px; border-radius: 20px; width: 300px; text-align: center;
        }
        .dark-mode .modal-content { background: #1f1f3a; color: white; }

        @media (max-width: 768px) {
            .hero-banner { height: 300px; }
            .hero-banner h2 { font-size: 22px; }
            .search-box { flex-direction: column; }
            .categories-grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
            .btn-add-main { display: none; } /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ —à–∞–ø–∫–µ –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö, —Ç–∞–∫ –∫–∞–∫ –µ—Å—Ç—å –ø–ª—é—Å –≤–Ω–∏–∑—É */
        }
    </style>
</head>
<body>

<header>
    <div class="container header-content">
        <h1 onclick="location.href='index.html'" style="cursor:pointer; margin:0; font-size: 24px; letter-spacing: -1px; color:#007bff;">Rogun<span style="color:#28a745">.tj</span></h1>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div id="user-menu"></div> 
            <button id="theme-toggle" style="cursor:pointer; border:none; background:none; font-size:22px;">üåô</button>
        </div>
    </div>
</header>

<section class="hero-banner">
    <div class="search-glass-box">
        <h2>–ù–∞–π–¥–∏ –ª—É—á—à–µ–µ –≤ –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–µ üèîÔ∏è</h2>
        <div class="search-box">
            <input type="text" id="search-input" placeholder="–ß—Ç–æ –∏—â–µ–º?" style="flex: 2; min-width: 200px;">
            
            <select id="region-filter">
                <option value="">–í–µ—Å—å –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω</option>
                <optgroup label="–û—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞">
                    <option value="–†–æ–≥—É–Ω">–†–æ–≥—É–Ω</option>
                    <option value="–î—É—à–∞–Ω–±–µ">–î—É—à–∞–Ω–±–µ</option>
                    <option value="–•—É–¥–∂–∞–Ω–¥">–•—É–¥–∂–∞–Ω–¥</option>
                    <option value="–ë–æ—Ö—Ç–∞—Ä">–ë–æ—Ö—Ç–∞—Ä</option>
                    <option value="–ö—É–ª—è–±">–ö—É–ª—è–±</option>
                    <option value="–í–∞—Ö–¥–∞—Ç">–í–∞—Ö–¥–∞—Ç</option>
                    <option value="–ò—Å—Ç–∞—Ä–∞–≤—à–∞–Ω">–ò—Å—Ç–∞—Ä–∞–≤—à–∞–Ω</option>
                    <option value="–ì–∏—Å—Å–∞—Ä">–ì–∏—Å—Å–∞—Ä</option>
                    <option value="–¢—É—Ä—Å—É–Ω–∑–∞–¥–µ">–¢—É—Ä—Å—É–Ω–∑–∞–¥–µ</option>
                    <option value="–ö–∞–Ω–∏–±–∞–¥–∞–º">–ö–∞–Ω–∏–±–∞–¥–∞–º</option>
                    <option value="–ò—Å—Ñ–∞—Ä–∞">–ò—Å—Ñ–∞—Ä–∞</option>
                    <option value="–ü–µ–Ω–¥–∂–∏–∫–µ–Ω—Ç">–ü–µ–Ω–¥–∂–∏–∫–µ–Ω—Ç</option>
                    <option value="–ù–æ—Ä–∞–∫">–ù–æ—Ä–∞–∫</option>
                    <option value="–•–æ—Ä—É–≥">–•–æ—Ä—É–≥</option>
                </optgroup>
                <optgroup label="–†–∞–π–æ–Ω—ã –∏ –ø–æ—Å–µ–ª–∫–∏">
                    <option value="–ù—É—Ä–æ–±–æ–¥">–ù—É—Ä–æ–±–æ–¥</option>
                    <option value="–§–∞–π–∑–æ–±–æ–¥">–§–∞–π–∑–æ–±–æ–¥</option>
                    <option value="–†–∞—à—Ç">–†–∞—à—Ç (–ì–∞—Ä–º)</option>
                    <option value="–í–∞—Ä–∑–æ–±">–í–∞—Ä–∑–æ–±</option>
                    <option value="–ê–π–Ω–∏">–ê–π–Ω–∏</option>
                    <option value="–î–∞–Ω–≥–∞—Ä–∞">–î–∞–Ω–≥–∞—Ä–∞</option>
                    <option value="–Ø–≤–∞–Ω">–Ø–≤–∞–Ω</option>
                    <option value="–†—É–¥–∞–∫–∏">–†—É–¥–∞–∫–∏</option>
                    <option value="–®–∞—Ö—Ä–∏–Ω–∞–≤">–®–∞—Ö—Ä–∏–Ω–∞–≤</option>
                    <option value="–õ–∞—Ö—à">–õ–∞—Ö—à</option>
                    <option value="–°–∞–Ω–≥–≤–æ—Ä">–°–∞–Ω–≥–≤–æ—Ä</option>
                    <option value="–¢–∞–¥–∂–∏–∫–∞–±–∞–¥">–¢–∞–¥–∂–∏–∫–∞–±–∞–¥</option>
                    <option value="–í–æ—Å–µ—ä">–í–æ—Å–µ—ä</option>
                    <option value="–§–∞—Ä—Ö–æ—Ä">–§–∞—Ä—Ö–æ—Ä</option>
                    <option value="–ú—É—Ä–≥–∞–±">–ú—É—Ä–≥–∞–±</option>
                </optgroup>
            </select>
            
            <a href="add.html" class="btn-add-main" style="background: #28a745; color: white; padding: 12px 20px; border-radius: 12px; text-decoration: none; font-weight: bold;">+ –ü–æ–¥–∞—Ç—å</a>
        </div>
    </div>
</section>

<div id="tg-modal" class="modal-tg">
    <div class="modal-content">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
        <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram:</p>
        <input type="text" id="input-tg-code" placeholder="00000" style="width: 80%; text-align: center; margin-bottom: 15px;">
        <button id="verify-btn" style="background:#28a745; color:white; border:none; padding:10px 20px; border-radius:10px; cursor:pointer; width:100%;">–í–æ–π—Ç–∏</button>
        <button onclick="document.getElementById('tg-modal').style.display='none'" style="background:none; border:none; color:red; display:block; margin: 10px auto; cursor:pointer;">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<div class="container">
    <div class="categories-grid" id="category-filter-container">
        <div class="category-item active" data-cat="">
            <div class="cat-icon">‚ú®</div>
            <span>–í—Å–µ</span>
        </div>
        <div class="category-item" data-cat="–ü—Ä–æ–¥—É–∫—Ç—ã">
            <div class="cat-icon">üçé</div>
            <span>–ü—Ä–æ–¥—É–∫—Ç—ã</span>
        </div>
        <div class="category-item" data-cat="–¢–µ—Ö–Ω–∏–∫–∞">
            <div class="cat-icon">üì±</div>
            <span>–¢–µ—Ö–Ω–∏–∫–∞</span>
        </div>
        <div class="category-item" data-cat="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">
            <div class="cat-icon">üöó</div>
            <span>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</span>
        </div>
        <div class="category-item" data-cat="–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å">
            <div class="cat-icon">üè†</div>
            <span>–ñ–∏–ª—å–µ</span>
        </div>
        <div class="category-item" data-cat="–û–¥–µ–∂–¥–∞">
            <div class="cat-icon">üëï</div>
            <span>–û–¥–µ–∂–¥–∞</span>
        </div>
        <div class="category-item" data-cat="–î–ª—è –¥–æ–º–∞">
            <div class="cat-icon">üõãÔ∏è</div>
            <span>–î–ª—è –¥–æ–º–∞</span>
        </div>
        <div class="category-item" data-cat="–£—Å–ª—É–≥–∏">
            <div class="cat-icon">üõ†Ô∏è</div>
            <span>–£—Å–ª—É–≥–∏</span>
        </div>
        <div class="category-item" data-cat="–†–∞–±–æ—Ç–∞">
            <div class="cat-icon">üíº</div>
            <span>–†–∞–±–æ—Ç–∞</span>
        </div>
    </div>

    <main id="ads-container" class="ads-grid"></main>
</div>

<div class="mobile-nav">
    <a href="index.html" class="nav-item active">
        <span>üè†</span>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </a>
    <a href="profile.html?tab=favs" class="nav-item">
        <span>‚ù§Ô∏è</span>
        <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
    </a>
    <a href="add.html" class="nav-item">
        <div class="add-icon-circle">‚ûï</div>
    </a>
    <a href="profile.html" class="nav-item">
        <span>üë§</span>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </a>
</div>

<script type="module">
    import { getAds, getCurrentUser } from './js/storage.js';

    const adsContainer = document.getElementById('ads-container');
    const searchInput = document.getElementById('search-input');
    const regionFilter = document.getElementById('region-filter');
    const userMenu = document.getElementById('user-menu');
    const themeBtn = document.getElementById('theme-toggle');
    const catItems = document.querySelectorAll('.category-item');

    let generatedCode = null;

    // –í–•–û–î –ß–ï–†–ï–ó –¢–ï–õ–ï–ì–†–ê–ú
    function startTgAuth() {
        generatedCode = Math.floor(10000 + Math.random() * 90000);
        window.open(`https://t.me/RoguntjBot?start=${generatedCode}`, '_blank'); 
        document.getElementById('tg-modal').style.display = 'block';
    }

    document.getElementById('verify-btn').onclick = function() {
        const userEntered = document.getElementById('input-tg-code').value;
        if (userEntered == generatedCode) {
            alert("‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!");
            document.getElementById('tg-modal').style.display = 'none';
        } else {
            alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!");
        }
    };

    function renderUserMenu() {
        const user = getCurrentUser();
        if (user) {
            userMenu.innerHTML = `<a href="profile.html" style="text-decoration:none; color:#007bff; font-weight:600;">üë§ –ö–∞–±–∏–Ω–µ—Ç</a>`;
        } else {
            userMenu.innerHTML = `<a href="javascript:void(0)" id="login-link" style="text-decoration:none; color:#007bff; font-weight:600;">–í–æ–π—Ç–∏</a>`;
            document.getElementById('login-link').onclick = startTgAuth;
        }
    }

    // –†–ï–ù–î–ï–† –û–ë–™–Ø–í–õ–ï–ù–ò–ô
    function updateAds() {
        const allAds = getAds() || [];
        const searchText = searchInput.value.toLowerCase();
        const selectedRegion = regionFilter.value;
        const activeItem = document.querySelector('.category-item.active');
        const selectedCategory = activeItem ? activeItem.dataset.cat : "";

        const filtered = allAds.filter(ad => {
            const matchesSearch = ad.title.toLowerCase().includes(searchText);
            const matchesRegion = !selectedRegion || ad.region === selectedRegion;
            const matchesCategory = !selectedCategory || ad.category === selectedCategory;
            return matchesSearch && matchesRegion && matchesCategory;
        });

        adsContainer.innerHTML = '';
        
        if (filtered.length === 0) {
            adsContainer.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #888;">üîç –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
            return;
        }

        filtered.sort((a, b) => b.id - a.id).forEach(ad => {
            const imageSrc = ad.images && ad.images.length > 0 ? ad.images[0] : 'https://via.placeholder.com/300x200?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${imageSrc}" alt="${ad.title}" loading="lazy">
                <div class="info">
                    <div class="price">${Number(ad.price).toLocaleString()} TJS</div>
                    <div class="title" style="font-weight:600; font-size:14px; margin:5px 0;">${ad.title}</div>
                    <div style="font-size:12px; color:#888;">üìç ${ad.region || '–†–æ–≥—É–Ω'}</div>
                </div>
            `;
            card.onclick = () => window.location.href = `detail.html?id=${ad.id}`;
            adsContainer.appendChild(card);
        });
    }

    catItems.forEach(item => {
        item.onclick = () => {
            catItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            updateAds();
        };
    });

    searchInput.oninput = updateAds;
    regionFilter.onchange = updateAds;
    
    themeBtn.onclick = () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        themeBtn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };

    if(localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        themeBtn.textContent = "‚òÄÔ∏è";
    }

    renderUserMenu();
    updateAds();
</script>
</body>
</html>