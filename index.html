<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rogun.tj ‚Äî –ú–∞–≥–∞–∑–∏–Ω –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ */
        .dark-mode { background-color: #1a1a1a; color: white; }
        .dark-mode .product-card { background: #2d2d2d; color: white; border: 1px solid #444; }
        .dark-mode header, .dark-mode footer { background: #111; }
        .header-content { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .ads-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { border: 1px solid #ddd; border-radius: 12px; overflow: hidden; position: relative; transition: 0.3s; cursor: pointer; background: white; color: #333; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .product-card img { width: 100%; height: 180px; object-fit: cover; }
        .product-card .info { padding: 15px; }
        .product-card .price { font-size: 20px; font-weight: bold; color: #28a745; margin-bottom: 5px; }
        .product-card .title { font-size: 16px; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-card .category-tag { font-size: 12px; color: #888; }
        .product-card .region-tag { font-size: 12px; color: #007bff; float: right; }
        .btn-add-main { background: #007bff; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; display: inline-block; }
        .cat-btn { padding: 8px 15px; border-radius: 20px; border: 1px solid #ddd; cursor: pointer; background: white; white-space: nowrap; }
        .cat-btn.active { background: #007bff; color: white; border-color: #007bff; }
        #user-menu a { text-decoration: none; color: #007bff; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div class="container header-content">
        <h1 style="margin:0;">Rogun.tj</h1>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div id="user-menu"></div> 
            <button id="theme-toggle" style="cursor:pointer; padding: 5px 10px; border-radius: 5px; border: 1px solid #ddd;">üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
        </div>
    </div>
</header>

<section class="search-section" style="background: #f8f9fa; padding: 20px 0; border-bottom: 1px solid #eee;">
    <div class="container">
        <div class="search-container" style="display: flex; gap: 10px; flex-wrap: wrap;">
            <input type="text" id="search-input" placeholder="–ß—Ç–æ –∏—â–µ–º?" style="padding: 10px; flex: 2; border-radius: 8px; border: 1px solid #ddd;">
            <select id="region-filter" style="padding: 10px; flex: 1; border-radius: 8px; border: 1px solid #ddd;">
                <option value="">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                <option value="–†–æ–≥—É–Ω">–†–æ–≥—É–Ω</option>
                <option value="–î—É—à–∞–Ω–±–µ">–î—É—à–∞–Ω–±–µ</option>
                <option value="–•—É–¥–∂–∞–Ω–¥">–•—É–¥–∂–∞–Ω–¥</option>
            </select>
            <a href="add.html" class="btn-add-main">+ –†–∞–∑–º–µ—Å—Ç–∏—Ç—å</a>
        </div>
    </div>
</section>

<nav id="category-filter-container" class="container" style="margin-top: 20px; display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;">
    <button class="cat-btn active" data-cat="">–í—Å–µ</button>
    <button class="cat-btn" data-cat="–ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –ú–∞–≥–∞–∑–∏–Ω">–ü—Ä–æ–¥—É–∫—Ç—ã</button>
    <button class="cat-btn" data-cat="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏ –ë—ã—Ç–æ–≤–∞—è –¢–µ—Ö–Ω–∏–∫–∞">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
    <button class="cat-btn" data-cat="–ú–∞–≥–∞–∑–∏–Ω –û–¥–µ–∂–¥–∞">–û–¥–µ–∂–¥–∞</button>
    <button class="cat-btn" data-cat="–£—Å–ª—É–≥–∏ –∏ –í–∞–∫–∞–Ω—Å–∏–∏">–£—Å–ª—É–≥–∏</button>
</nav>

<main class="container">
    <div id="ads-container" class="ads-grid"></div>
</main>

<footer style="margin-top: 50px; padding: 20px 0; border-top: 1px solid #eee; text-align: center; color: #888;">
    <div class="container">
        &copy; 2026 Rogun.tj | –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞
    </div>
</footer>

<script type="module">
    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±—Ä–∞–ª–∏ —Ç–æ—á–∫—É –ø–µ—Ä–µ–¥ /js/ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ GitHub
    import { getAds, getCurrentUser } from './js/storage.js';

    const adsContainer = document.getElementById('ads-container');
    const searchInput = document.getElementById('search-input');
    const regionFilter = document.getElementById('region-filter');
    const userMenu = document.getElementById('user-menu');
    const themeBtn = document.getElementById('theme-toggle');
    const catButtons = document.querySelectorAll('.cat-btn');

    // 1. –ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function renderUserMenu() {
        const user = getCurrentUser();
        if (user) {
            userMenu.innerHTML = `
                <a href="profile.html">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
                <span style="margin-left:10px; color:#888;">| ${user.email.split('@')[0]}</span>
            `;
        } else {
            userMenu.innerHTML = `<a href="login.html">–í–æ–π—Ç–∏</a>`;
        }
    }

    // 2. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
    function updateAds() {
        const allAds = getAds() || [];
        const searchText = searchInput.value.toLowerCase();
        const selectedRegion = regionFilter.value;
        const activeBtn = document.querySelector('.cat-btn.active');
        const selectedCategory = activeBtn ? activeBtn.dataset.cat : "";

        const filtered = allAds.filter(ad => {
            const matchesSearch = ad.title.toLowerCase().includes(searchText);
            const matchesRegion = !selectedRegion || ad.region === selectedRegion;
            const matchesCategory = !selectedCategory || ad.category === selectedCategory;
            return matchesSearch && matchesRegion && matchesCategory;
        });

        adsContainer.innerHTML = '';
        
        if (filtered.length === 0) {
            adsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 50px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>';
            return;
        }

        filtered.sort((a, b) => b.id - a.id).forEach(ad => {
            const imageSrc = ad.images && ad.images.length > 0 ? ad.images[0] : 'https://via.placeholder.com/300x190?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${imageSrc}" alt="${ad.title}">
                <div class="info">
                    <div class="price">${Number(ad.price).toLocaleString()} TJS</div>
                    <div class="title">${ad.title}</div>
                    <span class="category-tag">${ad.category}</span>
                    <span class="region-tag">üìç ${ad.region || '–†–æ–≥—É–Ω'}</span>
                </div>
            `;
            card.onclick = () => window.location.href = `detail.html?id=${ad.id}`;
            adsContainer.appendChild(card);
        });
    }

    // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
    catButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            catButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            updateAds();
        });
    });

    searchInput.addEventListener('input', updateAds);
    regionFilter.addEventListener('change', updateAds);
    
    themeBtn.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        themeBtn.textContent = document.body.classList.contains('dark-mode') ? "‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞" : "üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞";
    });

    // –ó–∞–ø—É—Å–∫
    renderUserMenu();
    updateAds();
</script>
</body>
</html>