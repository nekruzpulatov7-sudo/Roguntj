<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚Äî Rogun.tj</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .detail-container { max-width: 900px; margin: 30px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .detail-main { display: flex; gap: 30px; flex-wrap: wrap; }
        
        /* –ì–∞–ª–µ—Ä–µ—è */
        .detail-gallery { flex: 1; min-width: 300px; }
        .main-img { width: 100%; height: 400px; object-fit: cover; border-radius: 12px; margin-bottom: 10px; border: 1px solid #eee; }
        .thumbs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .thumbs img { width: 80px; height: 80px; object-fit: cover; cursor: pointer; border-radius: 8px; border: 2px solid transparent; transition: 0.2s; }
        .thumbs img:hover { border-color: #007bff; }

        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
        .detail-info { flex: 1; min-width: 300px; }
        .detail-price { font-size: 32px; font-weight: bold; color: #28a745; margin: 10px 0; }
        .detail-title { font-size: 24px; color: #333; margin-bottom: 15px; line-height: 1.2; }
        .meta-item { margin: 10px 0; color: #666; font-size: 15px; display: flex; align-items: center; gap: 8px; }
        
        /* –ö–Ω–æ–ø–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
        .contact-box { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 20px; text-align: center; border: 1px solid #eee; }
        .btn-show-phone { background: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-show-phone:hover { background: #0056b3; }
        .phone-number { font-size: 24px; font-weight: bold; color: #333; display: none; text-decoration: none; }
        .phone-number a { color: inherit; text-decoration: none; }

        @media (max-width: 768px) { .detail-main { flex-direction: column; } .main-img { height: 300px; } }
    </style>
</head>
<body>

<header style="border-bottom: 1px solid #eee; background: white;">
    <div class="container" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0;">
        <h1 onclick="window.location.href='index.html'" style="cursor:pointer; margin:0; font-size: 24px;">Rogun.tj</h1>
        <a href="index.html" style="text-decoration: none; color: #007bff; font-weight: bold;">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É</a>
    </div>
</header>

<main class="container">
    <div id="product-detail" class="detail-container">
        <p style="text-align: center; padding: 50px;">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è...</p>
    </div>
</main>

<script type="module">
    import { getAds } from './js/storage.js';

    const container = document.getElementById('product-detail');

    // 1. –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ —Å—Å—ã–ª–∫–∏
    const urlParams = new URLSearchParams(window.location.search);
    const adId = parseInt(urlParams.get('id'));

    // 2. –ò—â–µ–º —Ç–æ–≤–∞—Ä
    const allAds = getAds() || [];
    const ad = allAds.find(item => item.id === adId);

    if (!ad) {
        container.innerHTML = `<div style="text-align:center; padding: 50px;"><h2>–û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2><br><a href="index.html" class="btn">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a></div>`;
    } else {
        renderDetail(ad);
    }

    function renderDetail(ad) {
        const hasImages = ad.images && ad.images.length > 0;
        const mainPhoto = hasImages ? ad.images[0] : 'https://via.placeholder.com/600x400?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
        
        let thumbsHtml = '';
        if (hasImages && ad.images.length > 1) {
            ad.images.forEach(img => {
                thumbsHtml += `<img src="${img}" class="thumb-img" onclick="document.getElementById('main-img').src='${img}'">`;
            });
        }

        container.innerHTML = `
            <div class="detail-main">
                <div class="detail-gallery">
                    <img src="${mainPhoto}" id="main-img" class="main-img" alt="${ad.title}">
                    <div class="thumbs">${thumbsHtml}</div>
                </div>
                
                <div class="detail-info">
                    <div class="category-tag" style="color:#007bff; font-weight: bold;">${ad.category}</div>
                    <h1 class="detail-title">${ad.title}</h1>
                    <div class="detail-price">${Number(ad.price).toLocaleString()} TJS</div>
                    
                    <div class="meta-item">üìç <b>–†–µ–≥–∏–æ–Ω:</b> ${ad.region || '–†–æ–≥—É–Ω'}</div>
                    <div class="meta-item">üìÖ <b>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</b> ${ad.createdAt || ad.date || '–°–µ–≥–æ–¥–Ω—è'}</div>
                    
                    <div class="contact-box">
                        <button class="btn-show-phone" id="btn-phone">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</button>
                        <div class="phone-number" id="phone-val">
                            <a href="tel:${ad.phone}">üìû ${ad.phone}</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                <h3 style="margin-bottom: 10px;">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                <p style="line-height: 1.6; color: #444; white-space: pre-wrap;">${ad.desc || ad.description || '–ü—Ä–æ–¥–∞–≤–µ—Ü –Ω–µ –¥–æ–±–∞–≤–∏–ª –æ–ø–∏—Å–∞–Ω–∏–µ –∫ —ç—Ç–æ–º—É —Ç–æ–≤–∞—Ä—É.'}</p>
            </div>
        `;

        // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        const btnPhone = document.getElementById('btn-phone');
        const valPhone = document.getElementById('phone-val');
        
        if (btnPhone) {
            btnPhone.addEventListener('click', () => {
                btnPhone.style.display = 'none';
                valPhone.style.display = 'block';
            });
        }
    }
</script>

</body>
</html>