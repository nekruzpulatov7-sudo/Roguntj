<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход — Rogun.tj</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Центрируем карточку входа */
        body { background: #f4f7f6; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; font-family: sans-serif; }
        .login-card { max-width: 400px; width: 90%; padding: 30px; background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .login-card h2 { margin-bottom: 20px; color: #333; font-size: 24px; }
        
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; color: #666; font-size: 14px; }
        
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus { border-color: #007bff; box-shadow: 0 0 5px rgba(0,123,255,0.2); }
        
        .btn-send { width: 100%; padding: 14px; background: #007bff; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; margin-top: 10px; }
        .btn-send:hover { background: #0056b3; }
        
        #sms-section { display: none; margin-top: 20px; }
        .change-phone { font-size: 13px; color: #007bff; cursor: pointer; text-decoration: none; display: inline-block; margin-top: 15px; }
        .change-phone:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="login-card">
    <h2 onclick="window.location.href='index.html'" style="cursor:pointer">Rogun.tj</h2>
    
    <div id="phone-section">
        <p style="color: #777; font-size: 14px; margin-bottom: 20px;">Введите ваш номер для входа или регистрации</p>
        <div class="input-group">
            <label>Номер телефона</label>
            <input type="tel" id="phone-input" placeholder="+992 900 00 00 00" value="+992 ">
        </div>
        <button class="btn-send" id="btn-get-code">Получить код</button>
    </div>

    <div id="sms-section">
        <p style="font-size: 14px; color: #555;">Код отправлен на номер: <br><strong id="display-phone"></strong></p>
        <div class="input-group">
            <label>Код из СМС</label>
            <input type="number" id="sms-input" placeholder="0 0 0 0" maxlength="4">
        </div>
        <button class="btn-send" style="background: #28a745;" id="btn-verify">Войти</button>
        <a class="change-phone" id="btn-back">← Изменить номер</a>
    </div>
</div>

<script type="module">
    import { setCurrentUser } from './js/storage.js';

    const phoneSection = document.getElementById('phone-section');
    const smsSection = document.getElementById('sms-section');
    const phoneInput = document.getElementById('phone-input');
    const smsInput = document.getElementById('sms-input');
    const displayPhone = document.getElementById('display-phone');
    
    let generatedCode = null;

    // 1. Обработка кнопки "Получить код"
    document.getElementById('btn-get-code').onclick = () => {
        const phone = phoneInput.value.trim();
        
        // Простая проверка длины (минимум +992 и 9 цифр)
        if (phone.length < 13) {
            alert('Пожалуйста, введите полный номер телефона (+992 XXX XX XX XX)');
            return;
        }

        // Генерируем случайный 4-значный код
        generatedCode = Math.floor(1000 + Math.random() * 9000).toString();
        
        // Показываем код в алерте (имитация реального СМС)
        alert('ВАШ ПРОВЕРОЧНЫЙ КОД: ' + generatedCode); 
        
        // Переключаем интерфейс на ввод кода
        displayPhone.innerText = phone;
        phoneSection.style.display = 'none';
        smsSection.style.display = 'block';
        smsInput.focus();
    };

    // 2. Обработка кнопки "Войти"
    document.getElementById('btn-verify').onclick = () => {
        if (smsInput.value === generatedCode) {
            // Формируем данные пользователя
            const userData = {
                id: Date.now(), // Уникальный ID на основе времени
                phone: phoneInput.value.trim(),
                name: "Пользователь",
                email: phoneInput.value.trim() + "@rogun.tj" // Совместимость со старым кодом
            };
            
            // Сохраняем в localStorage через твой storage.js
            setCurrentUser(userData);
            
            alert('Вы успешно вошли на Rogun.tj!');
            window.location.href = 'index.html'; // Переход на главную
        } else {
            alert('Неверный код! Попробуйте еще раз или запросите новый.');
        }
    };

    // 3. Возврат к вводу номера
    document.getElementById('btn-back').onclick = (e) => {
        e.preventDefault();
        phoneSection.style.display = 'block';
        smsSection.style.display = 'none';
        smsInput.value = '';
    };
</script>

</body>
</html>